function $(a){return document.getElementById(a)}var CPLanguages,popup,fOp,edit,upload;CPLanguages={csharp:"C#",css:"CSS",generic:"Generic",html:"HTML",java:"Java",javascript:"JavaScript",perl:"Perl",ruby:"Ruby",php:"PHP",text:"Text",sql:"SQL",vbscript:"VBScript"};function ajax(b,g,e,c,a,d){json2markup(["div",{attributes:{id:"ajaxOverlay"}},"img",{attributes:{src:"pafm-files/images/ajax.gif",id:"ajaxImg",title:"Loading",alt:"Loading"}}],document.body);$("ajaxOverlay").style.height=document.body.offsetHeight+"px";fade($("ajaxOverlay"),0,6,25,"in");var f=window.ActiveXObject?new ActiveXObject("MSXML2.XMLHTTP.3.0"):new XMLHttpRequest();d&&f.upload.addEventListener("progress",d,false);f.open(g,b,true);f.onreadystatechange=function(){if(f.readyState!=4){return}fade($("ajaxOverlay"),6,0,25,"out",function(){document.body.removeChild($("ajaxOverlay"));document.body.removeChild($("ajaxImg"))});if(f.status==200||f.statusText=="OK"){if(f.responseText=="Please refresh the page and login"){alert("Please refresh the page and login")}else{c(f.responseText)}}else{alert("AJAX request unsuccessful.\nStatus Code: "+f.status+"\nStatus Text: "+f.statusText+"\nParameters: "+b)}f=null};if(g.toLowerCase()=="post"&&!a){f.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}f.send(e)}function json2markup(c,g){var b=0,a=c.length,d,f,e;for(;b<a;b++){if(c[b].constructor==Array){json2markup(c[b],d)}else{if(c[b].constructor==Object){if(c[b].attributes){for(f in c[b].attributes){switch(f.toLowerCase()){case"class":d.className=c[b].attributes[f];break;case"style":d.style.cssText=c[b].attributes[f];break;case"for":d.htmlFor=c[b].attributes[f];break;default:d.setAttribute(f,c[b].attributes[f])}}}if(c[b].events){for(e in c[b].events){d.addEventListener(e,c[b].events[e],false)}}if(c[b].preText){g.appendChild(document.createTextNode(c[b].preText))}if(c[b].text){d.appendChild(document.createTextNode(c[b].text))}switch(c[b].insert){case"before":g.parentNode.insertBefore(d,g);break;case"after":g.parentNode.insertBefore(d,g.nextSibling);break;case"under":default:g.appendChild(d)}if(c[b].postText){g.appendChild(document.createTextNode(c[b].postText))}}else{d=document.createElement(c[b])}}}}function fade(e,f,g,c,h,i){var d=e.style.opacity!=undefined,b,a;e.style[d?"opacity":"filter"]=d?f/10:"alpha(opacity="+f*10+")";a=setInterval(function(){if(h=="in"){f++;b=f<=g}else{if(h=="out"){f--;b=f>=g}}if(b){e.style[d?"opacity":"filter"]=d?f/10:"alpha(opacity="+f*10+")"}else{clearInterval(a);if(i){i()}}},c)}popup={init:function(e,b){json2markup(["div",{attributes:{id:"popOverlay"},events:{click:popup.close}}],document.body);json2markup(["div",{attributes:{id:"popup"}},["div",{attributes:{id:"head"}},["a",{attributes:{id:"x",href:"#"},events:{click:function(g){popup.close();g.preventDefault?g.preventDefault():g.returnValue=false}},text:"[x]"},"span",{text:e}],"div",{attributes:{id:"body"}}]],document.body);var f=$("popup"),d=$("popOverlay"),a=$("x"),c;if(window.ActiveXObject){a.style.cssFloat="none";a.style.position="absolute";a.style.right=a.parentNode.offsetLeft+3}json2markup(b,$("body"));if(c=$("moveListUL")){if(c.offsetHeight>(document.body.offsetHeight-150)){c.style.height=document.body.offsetHeight-150+"px"}}f.style.marginTop="-"+parseInt(f.offsetHeight)/2+"px";f.style.marginLeft="-"+parseInt(f.offsetWidth)/2+"px";fade(d,0,6,25,"in");document.onkeydown=function(g){if((g||window.event).keyCode==27){popup.close();return false}}},close:function(){if($("popup")){var a=$("popOverlay");fade(a,6,0,25,"out",function(){document.body.removeChild(a)});document.body.removeChild($("popup"))}document.onkeydown=null}};fOp={rename:function(a,b){popup.init("Rename:",["form",{attributes:{action:"?do=rename&subject="+a+"&path="+b,method:"post"}},["input",{attributes:{title:"Rename To",type:"text",name:"rename",value:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},create:function(a,b){popup.init("Create "+a+":",["form",{attributes:{method:"post",action:"?do=create&path="+b}},["input",{attributes:{title:"Filename",type:"text",name:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},chmod:function(c,b,a){popup.init("Chmod "+unescape(b)+":",["form",{attributes:{method:"post",action:"?do=chmod&subject="+b+"&path="+c}},["input",{attributes:{title:"chmod",type:"text",name:"mod",value:a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},copy:function(a,b){popup.init("Copy "+unescape(a)+":",["form",{attributes:{method:"post",action:"?do=copy&subject="+a+"&path="+b}},["input",{attributes:{title:"copy to",type:"text",name:"name",value:"copy-"+a}},"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])},moveList:function(a,b,c){ajax(("?do=moveList&subject="+a+"&path="+b+"&to="+c),"get",null,function(e){if(!$("popup")){popup.init("Move "+unescape(a)+" to:",Function("return "+e)())}else{var g=$("popup"),d=$("x"),f;$("body").innerHTML="";json2markup(Function("return "+e)(),$("body"));if(window.ActiveXObject){d.style.right=d.parentNode.offsetLeft+3}if((f=$("moveListUL")).offsetHeight>(document.body.offsetHeight-150)){f.style.height=document.body.offsetHeight-150+"px"}g.style.marginTop="-"+parseInt(g.offsetHeight)/2+"px";g.style.marginLeft="-"+parseInt(g.offsetWidth)/2+"px"}})},remoteCopy:function(a){popup.init("Remote Copy:",["form",{attributes:{method:"post",action:"?do=remoteCopy&path="+a}},["legend",{text:"Location: "},["input",{attributes:{title:"Remote Copy",type:"text",name:"location"},events:{change:function(b){$("remoteCopyName").value=this.value.replace(/\\/g,"/").replace(/.*\//,"")}}}],"legend",{text:"Name: "},["input",{attributes:{id:"remoteCopyName",title:"Name",type:"text",name:"name"}}],"input",{attributes:{title:"Ok",type:"submit",value:"\u2713"}}]])}};edit={init:function(b,c,a){json2markup(["div",{attributes:{id:"editOverlay"}}],document.body);$("editOverlay").style.height=document.body.offsetHeight+"px";json2markup(["div",{attributes:{id:"ea"}},["textarea",{attributes:{id:"ta",rows:"30",cols:"90"}},"br",{},"input",{attributes:{type:"text",value:unescape(b),readonly:""}},"input",{attributes:{type:"button",value:"Save",id:"save"},events:{click:function(){edit.save(b,c)}}},"input",{attributes:{type:"button",value:"Exit",id:"exit"},events:{click:function(){edit.exit(b,c)}}},"span",{attributes:{id:"editMsg"}}]],document.body);document.onkeydown=function(d){if((d||window.event).keyCode==27){edit.exit(b,c);return false}};ajax("?do=readFile&path="+c+"&subject="+b,"get",null,function(d){$("ta").value=d});location="#header"},save:function(b,c){$("editMsg").innerHTML=null;var a="data="+encodeURIComponent($("ta").value);ajax("?do=saveEdit&subject="+b+"&path="+c,"post",a,function(d){$("editMsg").className=d!="Saved"?"failed":"succeeded";$("editMsg").innerHTML=d});window.__FILESAVED=true},exit:function(a,b){if(window.__FILESAVED){ajax("?do=getfs&path="+b+"&subject="+a,"get",null,function(e){var g=$("dirList").getElementsByTagName("li"),d=unescape(a),f=0,c=g.length;for(;f<c;f++){if(g[f].title==d){g[f].getElementsByTagName("span")[0].innerHTML=e;break}}})}document.body.removeChild($("ea"));document.body.removeChild($("editOverlay"));window.__FILESAVED=null;document.onkeydown=null}};upload={init:function(b,a){var c={attributes:{type:"file",id:"file_input",name:"file[]",multiple:""},events:{change:function(d){upload.chk((d.srcElement||d.target).value,b)}}};popup.init("Upload:",["form",{attributes:{id:"upload",action:"?do=upload&path="+b,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}},["input",{attributes:{type:"hidden",name:"MAX_FILE_SIZE",value:a}},"input",c],"div",{attributes:{id:"response"},text:"php.ini upload limit: "+Math.floor(a/1048576)+" MB"},])},chk:function(b,c){var a=b.split(/\\|\//g);a=a.push?a[a.length-1]:a;ajax("?do=fileExists&path="+c+"&subject="+a,"GET",null,function(d){if(d=="1"){json2markup(["input",{insert:"after",attributes:{type:"button",value:"Replace?"},events:{click:function(f){upload.submit(c)}}}],$("file_input"))}else{upload.submit(c)}})},submit:function(b){var a=new FormData();a.append("file[]",$("file_input").files[0]);ajax("?do=upload&path="+b,"POST",a,function(c){$("response").innerHTML=c},true,function(d){if(d.lengthComputable){var c=Math.round((d.loaded*100)/d.total);$("response").innerHTML="uploaded:"+c+"%"}});location.reload(true)}};